---
- name: Setup service group and add host
  citrix.adc.citrix_adc_servicegroup:
    nsip: "{{ nsip }}"
    nitro_user: "{{ nitro_user }}"
    nitro_pass: "{{ nitro_pass }}"
    servicegroupname: service-group-https
    maxclient: "4000"
    servicetype: TCP
    validate_certs: false
    servicemembers:
      mode: bind
      attributes:
        - servername: "{{ inventory_hostname }}"
          port: 443
          weight: "50"
    monitor_bindings:
      mode: exact
      attributes:
        - monitor_name: https
          weight: "50"
  delegate_to: localhost

- name: Set stats for the e-mail body and ServiceNow
  ansible.builtin.set_stats:
    data:
      email_body: "{{ email_body }} Load Balancer: https://citrixlb.shadowman.dev "
      work_notes: "{{ work_notes }} [code]<a href='https://citrixlb.shadowman.dev'>Load Balancer</a>[/code] "
  run_once: true
  when: email_body is defined
